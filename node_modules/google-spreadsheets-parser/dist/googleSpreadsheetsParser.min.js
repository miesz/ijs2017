var GoogleSpreadsheetsParser,GoogleSpreadsheetsUtil,XMLHttpRequest;XMLHttpRequest||(XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest);
GoogleSpreadsheetsUtil=function(){function e(){}e.prototype.extractKey=function(b){b=b.match(/https:\/\/docs.google.com\/spreadsheets\/d\/(.+)\/pubhtml/);return null===b||2!==b.length?null:b[1]};e.prototype.getWorksheetId=function(b,d){var a,c,f,g;a=new XMLHttpRequest;a.open("GET","https://spreadsheets.google.com/feeds/worksheets/"+b+"/public/basic?alt=json",!1);a.send();f=[];if(200===a.status)if(a=JSON.parse(a.responseText),d)for(c in g=a.feed.entry,g){if(a=g[c],a.title.$t===d){f=a.id.$t.match(/https:\/\/spreadsheets.google.com\/feeds\/worksheets\/.+\/public\/basic\/(.+)/);
break}}else f=a.feed.entry[0].id.$t.match(/https:\/\/spreadsheets.google.com\/feeds\/worksheets\/.+\/public\/basic\/(.+)/);return null===f||2!==f.length?null:f[1]};e.prototype.getFeeds=function(b,d){var a,c;c=new XMLHttpRequest;c.open("GET","https://spreadsheets.google.com/feeds/cells/"+b+"/"+d+"/public/values?alt=json",!1);c.send();a=null;200===c.status&&(a=JSON.parse(c.responseText));return a};e.prototype.makeTitle=function(b){var d,a,c,f;f=[];a=0;for(c=b.length;a<c;a++){d=b[a];d=d.gs$cell;if(null===
d)break;if(1===Number(d.row))f.push(d.$t);else break}return f};e.prototype.makeContents=function(b){var d,a,c,f,g,e,h;c=[];if(!(1<=b.length&&b[0].gs$cell))return c;a=Number(b[b.length-1].gs$cell.col);f=h=0;for(g=b.length;f<g;f++)d=b[f],d=d.gs$cell,1!==Number(d.row)&&(d.row!==h&&(h=d.row,e=[]),e.push(d.$t),Number(d.col)===a&&(c.push(e),e=[]));return c};return e}();
GoogleSpreadsheetsParser=function(){function e(b,d){var a,c,f,g;g=d.sheetTitle||null;f=d.hasTitle||!0;a=new GoogleSpreadsheetsUtil;c=a.extractKey(b);g=a.getWorksheetId(c,g);c=a.getFeeds(c,g).feed.entry;f&&(this.titles=a.makeTitle(c));this.contents=a.makeContents(c)}e.prototype.toJson=function(){var b;b=this.contents.map(function(d){return function(a){var c,b,g,e,h,k;e={};g=d.titles;k=c=0;for(b=g.length;c<b;k=++c)h=g[k],e[h]=a[k];return e}}(this));return JSON.stringify(b)};return e}();
